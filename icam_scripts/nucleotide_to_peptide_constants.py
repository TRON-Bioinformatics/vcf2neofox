#    iCaM2.0 NGS data analysis pipeline
#    Copyright (C) 2011-2016 TRON gGmbH
#    See LICENSE for licensing details.
#
#    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
#    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
#    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
#    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
#    SOFTWARE.


# static data

reverse_codon_table = {"A":("GCT","GCC","GCA","GCG"), "L":("TTA","TTG","CTT","CTC","CTA","CTG"), "R":("CGT","CGC","CGA","CGG","AGA","AGG"), "K":("AAA","AAG"), "N":("AAT","AAC"), "M":("ATG"), "D":("GAT","GAC"), "F":("TTT","TTC"), "C":("TGT","TGC"), "P":("CCT","CCC","CCA","CCG"), "Q":("CAA","CAG"), "S":("TCT","TCC","TCA","TCG","AGT","AGC"), "E":("GAA","GAG"), "T":("ACT","ACC","ACA","ACG"), "G":("GGT","GGC","GGA","GGG"), "W":("TGG",), "H":("CAT","CAC"), "Y":("TAT","TAC"), "I":("ATT","ATC","ATA"), "V":("GTT","GTC","GTA","GTG"), "-STOP-":("TAA","TGA","TAG")}

stop_codon = "-"

codon_table =        ({"TTT":"F", "TTC":"F", "TTA":"L", "TTG":"L", "CTT":"L", "CTC":"L", "CTA":"L", "CTG":"L", "ATT":"I",
 "ATC":"I", "ATA":"I", "ATG":"M", "GTT":"V", "GTC":"V", "GTA":"V", "GTG":"V", "TCT":"S", "TCC":"S", "TCA":"S", "TCG":"S",
 "CCT":"P", "CCC":"P", "CCA":"P", "CCG":"P", "ACT":"T", "ACC":"T", "ACA":"T", "ACG":"T", "GCT":"A", "GCC":"A", "GCA":"A",
 "GCG":"A", "TAT":"Y", "TAC":"Y", "TAA":stop_codon, "TAG":stop_codon, "CAT":"H", "CAC":"H", "CAA":"Q", "CAG":"Q", "AAT":"N", "AAC":"N",
 "AAA":"K", "AAG":"K", "GAT":"D", "GAC":"D", "GAA":"E", "GAG":"E", "TGT":"C", "TGC":"C", "TGA":stop_codon, "TGG":"W", "CGT":"R",
 "CGC":"R", "CGA":"R", "CGG":"R", "AGT":"S", "AGC":"S", "AGA":"R", "AGG":"R", "GGT":"G", "GGC":"G", "GGA":"G", "GGG":"G"})

complement_table = {"G":"C","C":"G","A":"T","T":"A","g":"c","c":"g","a":"t","t":"a","N":"N","n":"n"}

window_sizes = (8,9,10,11,15)

# ok for version  v_2.13
mhcII_human = {"consensus3":{15:["HLA-DPA1*01/DPB1*04:01","HLA-DRB1*01:01","HLA-DRB1*04:04","HLA-DRB1*08:04","HLA-DRB1*11:21","HLA-DRB1*13:27","HLA-DPA1*01:03/DPB1*02:01","HLA-DRB1*01:02","HLA-DRB1*04:05","HLA-DRB1*08:06","HLA-DRB1*11:28","HLA-DRB1*13:28","HLA-DPA1*02:01/DPB1*01:01","HLA-DRB1*03:01","HLA-DRB1*04:08","HLA-DRB1*08:13","HLA-DRB1*13:01","HLA-DRB1*15:01","HLA-DPA1*02:01/DPB1*05:01","HLA-DRB1*03:05","HLA-DRB1*04:10","HLA-DRB1*08:17","HLA-DRB1*13:02","HLA-DRB1*15:02","HLA-DPA1*03:01/DPB1*04:02","HLA-DRB1*03:06","HLA-DRB1*04:21","HLA-DRB1*11:01","HLA-DRB1*13:04","HLA-DRB1*15:06","HLA-DQA1*01:01/DQB1*05:01","HLA-DRB1*03:07","HLA-DRB1*04:23","HLA-DRB1*11:02","HLA-DRB1*13:05","HLA-DRB3*01:01","HLA-DQA1*01:02/DQB1*06:02","HLA-DRB1*03:08","HLA-DRB1*04:26","HLA-DRB1*11:04","HLA-DRB1*13:07","HLA-DRB4*01:01","HLA-DQA1*03:01/DQB1*03:02","HLA-DRB1*03:09","HLA-DRB1*07:01","HLA-DRB1*11:06","HLA-DRB1*13:11","HLA-DRB5*01:01","HLA-DQA1*04:01/DQB1*04:02","HLA-DRB1*03:11","HLA-DRB1*07:03","HLA-DRB1*11:07","HLA-DRB1*13:21","HLA-DRB5*01:05","HLA-DQA1*05:01/DQB1*02:01","HLA-DRB1*04:01","HLA-DRB1*08:01","HLA-DRB1*11:14","HLA-DRB1*13:22","HLA-DQA1*05:01/DQB1*03:01","HLA-DRB1*04:02","HLA-DRB1*08:02","HLA-DRB1*11:20","HLA-DRB1*13:23"]}, "arbpython":{15:["HLA-DPA1*01/DPB1*04:01","HLA-DRB1*01:01","HLA-DRB1*15:01","HLA-DPA1*01:03/DPB1*02:01","HLA-DRB1*03:01","HLA-DRB3*01:01""HLA-DPA1*02:01/DPB1*01:01","HLA-DRB1*04:01","HLA-DRB4*01:01","HLA-DPA1*02:01/DPB1*05:01","HLA-DRB1*04:04","HLA-DRB5*01:01","HLA-DPA1*03:01/DPB1*04:02","HLA-DRB1*04:05","HLA-DQA1*01:01/DQB1*05:01","HLA-DRB1*07:01","HLA-DQA1*01:02/DQB1*06:02","HLA-DRB1*08:02","HLA-DQA1*03:01/DQB1*03:02","HLA-DRB1*09:01","HLA-DQA1*04:01/DQB1*04:02","HLA-DRB1*11:01","HLA-DQA1*05:01/DQB1*02:01","HLA-DRB1*12:01","HLA-DQA1*05:01/DQB1*03:01","HLA-DRB1*13:02"]}}


#substitution_matrices
_matrix_text="""#ID=WAG250
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	2.153886	-0.683764	-0.144115	-0.218615	-0.123785	-0.305813	0.10147	0.485179	-1.278083	-0.849476	-1.552455	-0.27805	-0.824133	-2.689637	0.479474	0.964998	0.788974	-3.2557	-2.460885	0.027625
R	-0.683764	5.004821	0.148442	-0.909708	-1.712699	1.664989	0.108887	-1.009752	1.153897	-2.396888	-1.857336	2.706759	-1.182285	-3.086308	-0.568453	-0.126988	-0.456957	-0.302368	-1.838704	-2.156557
N	-0.144115	0.148442	2.838794	2.208874	-2.081585	0.620467	1.031188	0.137026	1.418131	-2.326284	-2.846069	0.962613	-1.984593	-2.790818	-1.036794	0.906638	0.473511	-3.185567	-0.820424	-2.072958
D	-0.218615	-0.909708	2.208874	4.593437	-3.587961	0.785746	2.880828	0.123637	0.266132	-3.523115	-3.839123	0.336553	-2.89692	-4.292628	-1.023406	0.190217	-0.509692	-4.000298	-2.284218	-2.733564
C	-0.123785	-1.712699	-2.081585	-3.587961	11.978635	-2.921558	-3.343719	-1.940361	-2.508322	-1.43787	-1.61104	-2.826566	-1.510766	-1.541911	-2.720867	0.069244	-0.810004	-0.367848	-1.230908	-0.244942
Q	-0.305813	1.664989	0.620467	0.785746	-2.921558	3.253942	1.852973	-1.284791	1.679049	-2.08289	-1.451503	1.808151	-0.788291	-2.953117	-0.284307	-0.138238	-0.260044	-2.771218	-1.872761	-1.767321
E	0.10147	0.108887	1.031188	2.880828	-3.343719	1.852973	3.304684	-0.52913	0.060604	-2.615259	-2.856049	1.190971	-1.933248	-4.009962	-0.530983	-0.055189	-0.290324	-3.71579	-2.730975	-1.851461
G	0.485179	-1.009752	0.137026	0.123637	-1.940361	-1.284791	-0.52913	6.003035	-1.853709	-4.089112	-4.448002	-1.107115	-3.313362	-5.06663	-1.697055	0.347182	-1.132972	-2.782002	-3.836095	-2.925552
H	-1.278083	1.153897	1.418131	0.266132	-2.508322	1.679049	0.060604	-1.853709	6.555647	-2.552907	-1.719223	0.517406	-1.590741	0.104316	-0.811516	-0.376981	-0.864609	-1.320202	2.664314	-2.54563
I	-0.849476	-2.396888	-2.326284	-3.523115	-1.43787	-2.08289	-2.615259	-4.089112	-2.552907	4.426449	2.706536	-2.191444	2.591941	0.68815	-2.637766	-1.66403	-0.081178	-1.922126	-1.166363	3.518442
L	-1.552455	-1.857336	-2.846069	-3.839123	-1.61104	-1.451503	-2.856049	-4.448002	-1.719223	2.706536	4.667676	-2.255791	3.040707	1.995994	-2.134686	-2.082433	-1.259024	-0.511466	-0.384585	1.873033
K	-0.27805	2.706759	0.962613	0.336553	-2.826566	1.808151	1.190971	-1.107115	0.517406	-2.191444	-2.255791	3.363019	-1.165204	-3.628833	-0.648084	0.060028	0.111776	-2.870885	-2.546899	-1.889158
M	-0.824133	-1.182285	-1.984593	-2.89692	-1.510766	-0.788291	-1.933248	-3.313362	-1.590741	2.591941	3.040707	-1.165204	5.16732	0.831035	-2.167468	-1.329766	-0.235294	-1.200113	-0.973801	1.828626
F	-2.689637	-3.086308	-2.790818	-4.292628	-1.541911	-2.953117	-4.009962	-5.06663	0.104316	0.68815	1.995994	-3.628833	0.831035	7.674337	-3.342844	-2.117814	-2.402829	2.392811	5.386175	-0.105621
P	0.479474	-0.568453	-1.036794	-1.023406	-2.720867	-0.284307	-0.530983	-1.697055	-0.811516	-2.637766	-2.134686	-0.648084	-2.167468	-3.342844	7.309919	0.496427	-0.123398	-3.716549	-2.806228	-1.900429
S	0.964998	-0.126988	0.906638	0.190217	0.069244	-0.138238	-0.055189	0.347182	-0.376981	-1.66403	-2.082433	0.060028	-1.329766	-2.117814	0.496427	1.86248	1.306831	-2.141807	-1.334156	-1.20048
T	0.788974	-0.456957	0.473511	-0.509692	-0.810004	-0.260044	-0.290324	-1.132972	-0.864609	-0.081178	-1.259024	0.111776	-0.235294	-2.402829	-0.123398	1.306831	2.844855	-3.196269	-2.066172	0.076321
W	-3.2557	-0.302368	-3.185567	-4.000298	-0.367848	-2.771218	-3.71579	-2.782002	-1.320202	-1.922126	-0.511466	-2.870885	-1.200113	2.392811	-3.716549	-2.141807	-3.196269	13.470414	3.325188	-1.999798
Y	-2.460885	-1.838704	-0.820424	-2.284218	-1.230908	-1.872761	-2.730975	-3.836095	2.664314	-1.166363	-0.384585	-2.546899	-0.973801	5.386175	-2.806228	-1.334156	-2.066172	3.325188	7.867289	-1.660868
V	0.027625	-2.156557	-2.072958	-2.733564	-0.244942	-1.767321	-1.851461	-2.925552	-2.54563	3.518442	1.873033	-1.889158	1.828626	-0.105621	-1.900429	-1.20048	0.076321	-1.999798	-1.660868	3.752556
#ID=WAG*250
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	2.112414	-0.599087	-0.138571	-0.241604	0.101633	-0.269586	0.091341	0.449788	-1.172449	-0.923768	-1.569907	-0.27334	-0.836788	-2.657469	0.528858	0.992511	0.796368	-3.060596	-2.378711	-0.045917
R	-0.599087	4.73167	0.184961	-0.878274	-1.606218	1.604461	0.101648	-0.911346	1.138537	-2.357527	-1.830433	2.71385	-1.185992	-2.989347	-0.520948	-0.027203	-0.383714	-0.25586	-1.755451	-2.083609
N	-0.138571	0.184961	2.924642	2.212459	-2.134859	0.639872	1.019635	0.137791	1.351693	-2.354079	-2.830989	0.927586	-1.983065	-2.838237	-1.036163	0.909742	0.456448	-3.123323	-0.843626	-2.102761
D	-0.241604	-0.878274	2.212459	4.636237	-3.488206	0.774087	2.840709	0.137779	0.249562	-3.573153	-3.833855	0.255707	-2.913467	-4.298716	-0.979465	0.216639	-0.508109	-3.855652	-2.272407	-2.769443
C	0.101633	-1.606218	-2.134859	-3.488206	11.679069	-2.778562	-3.157589	-1.913988	-2.199803	-1.207234	-1.299178	-2.70741	-1.280274	-1.264252	-2.628408	-0.014473	-0.800713	-0.425724	-1.395045	-0.007331
Q	-0.269586	1.604461	0.639872	0.774087	-2.778562	3.136919	1.827696	-1.233734	1.725651	-2.078012	-1.458321	1.822427	-0.756159	-2.915815	-0.311065	-0.139229	-0.256574	-2.698566	-1.756681	-1.741822
E	0.091341	0.101648	1.019635	2.840709	-3.157589	1.827696	3.286568	-0.503441	0.107655	-2.646817	-2.853391	1.117285	-1.941803	-3.95717	-0.470363	0.000948	-0.245063	-3.531535	-2.643132	-1.866215
G	0.449788	-0.911346	0.137791	0.137779	-1.913988	-1.233734	-0.503441	5.967501	-1.734978	-4.107415	-4.374727	-1.080481	-3.251692	-4.972572	-1.660546	0.338217	-1.158723	-2.594597	-3.765569	-2.948429
H	-1.172449	1.138537	1.351693	0.249562	-2.199803	1.725651	0.107655	-1.734978	6.15231	-2.473358	-1.688546	0.529684	-1.538695	0.092668	-0.783085	-0.292535	-0.774806	-1.286425	2.750342	-2.453463
I	-0.923768	-2.357527	-2.354079	-3.573153	-1.207234	-2.078012	-2.646817	-4.107415	-2.473358	4.504378	2.682189	-2.22244	2.515701	0.674584	-2.615762	-1.702892	-0.058345	-1.710752	-1.097325	3.500018
L	-1.569907	-1.830433	-2.830989	-3.833855	-1.299178	-1.458321	-2.853391	-4.374727	-1.688546	2.682189	4.65104	-2.254329	3.012973	1.952827	-2.115454	-2.064188	-1.215305	-0.395382	-0.34755	1.844736
K	-0.27334	2.71385	0.927586	0.255707	-2.70741	1.822427	1.117285	-1.080481	0.529684	-2.22244	-2.254329	3.347389	-1.186017	-3.603576	-0.590672	0.107664	0.144057	-2.670671	-2.461082	-1.909036
M	-0.836788	-1.185992	-1.983065	-2.913467	-1.280274	-0.756159	-1.941803	-3.251692	-1.538695	2.515701	3.012973	-1.186017	5.317356	0.762552	-2.129767	-1.300781	-0.188051	-1.044404	-0.958894	1.760116
F	-2.657469	-2.989347	-2.838237	-4.298716	-1.264252	-2.915815	-3.95717	-4.972572	0.092668	0.674584	1.952827	-3.603576	0.762552	7.683017	-3.332455	-2.105563	-2.374933	2.373149	5.341226	-0.115553
P	0.528858	-0.520948	-1.036163	-0.979465	-2.628408	-0.311065	-0.470363	-1.660546	-0.783085	-2.615762	-2.115454	-0.590672	-2.129767	-3.332455	7.251986	0.434482	-0.1613	-3.684301	-2.803395	-1.875307
S	0.992511	-0.027203	0.909742	0.216639	-0.014473	-0.139229	0.000948	0.338217	-0.292535	-1.702892	-2.064188	0.107664	-1.300781	-2.105563	0.434482	1.859399	1.192653	-2.088086	-1.372763	-1.234574
T	0.796368	-0.383714	0.456448	-0.508109	-0.800713	-0.256574	-0.245063	-1.158723	-0.774806	-0.058345	-1.215305	0.144057	-0.188051	-2.374933	-0.1613	1.192653	2.821178	-3.083721	-2.066154	0.087787
W	-3.060596	-0.25586	-3.123323	-3.855652	-0.425724	-2.698566	-3.531535	-2.594597	-1.286425	-1.710752	-0.395382	-2.670671	-1.044404	2.373149	-3.684301	-2.088086	-3.083721	13.301573	3.132537	-1.803404
Y	-2.378711	-1.755451	-0.843626	-2.272407	-1.395045	-1.756681	-2.643132	-3.765569	2.750342	-1.097325	-0.34755	-2.461082	-0.958894	5.341226	-2.803395	-1.372763	-2.066154	3.132537	7.795525	-1.567468
V	-0.045917	-2.083609	-2.102761	-2.769443	-0.007331	-1.741822	-1.866215	-2.948429	-2.453463	3.500018	1.844736	-1.909036	1.760116	-0.115553	-1.875307	-1.234574	0.087787	-1.803404	-1.567468	3.791293
#ID=LG250
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	2.720096	-1.293984	-0.310919	-0.840396	1.376502	-0.582489	-0.535567	1.398339	-1.394303	-0.69175	-1.533719	-1.042151	-0.778363	-2.588363	0.245538	1.60427	1.106765	-3.634423	-2.909853	0.248672
R	-1.293984	5.364452	0.321067	-1.246955	-1.938495	1.985461	0.021591	-1.688201	1.404014	-3.674896	-3.248775	3.851736	-2.129032	-4.164435	-1.883705	-0.474631	-0.662937	-2.17102	-2.406849	-3.240142
N	-0.310919	0.321067	4.002537	2.791888	-1.039225	0.785446	0.973464	0.769555	1.828838	-3.880605	-4.170054	0.914911	-2.735345	-3.791105	-1.803378	1.320244	0.64561	-4.328725	-1.615841	-3.109236
D	-0.840396	-1.246955	2.791888	5.715545	-2.862262	0.811754	3.6993	0.170686	0.255408	-5.702935	-5.981733	-0.10159	-4.311446	-6.13708	-1.583122	0.355307	-0.639379	-6.211701	-3.842757	-4.479712
C	1.376502	-1.938495	-1.039225	-2.862262	9.884239	-2.151613	-3.065619	-0.470762	-1.149426	-0.122273	-0.581981	-2.58782	-0.280151	0.092555	-2.39208	1.158078	0.598264	-0.814936	0.126374	0.70754
Q	-0.582489	1.985461	0.785446	0.811754	-2.151613	3.649419	2.159964	-1.527356	1.831446	-3.048618	-2.529263	2.067264	-1.422936	-3.625773	-1.104413	-0.065583	-0.273584	-3.450669	-2.147454	-2.600745
E	-0.535567	0.021591	0.973464	3.6993	-3.065619	2.159964	4.774621	-1.048822	-0.169409	-4.602267	-4.770174	1.146937	-3.302922	-5.845381	-1.404187	-0.236009	-0.740278	-5.616646	-4.190394	-3.540558
G	1.398339	-1.688201	0.769555	0.170686	-0.470762	-1.527356	-1.048822	7.475668	-1.640885	-4.908769	-5.268592	-1.61598	-3.80537	-5.322344	-2.066176	1.120334	-0.806598	-3.846239	-4.698285	-3.37271
H	-1.394303	1.404014	1.828838	0.255408	-1.149426	1.831446	-0.169409	-1.640885	6.217789	-3.243328	-2.470217	0.636131	-1.883974	0.287712	-1.691202	-0.235302	-0.749458	-0.25656	3.269526	-3.034078
I	-0.69175	-3.674896	-3.880605	-5.702935	-0.122273	-3.048618	-4.602267	-4.908769	-3.243328	4.163003	3.147142	-3.749449	2.687196	1.087165	-3.683552	-2.251634	-0.256825	-2.108091	-1.304776	3.680936
L	-1.533719	-3.248775	-4.170054	-5.981733	-0.581981	-2.529263	-4.770174	-5.268592	-2.470217	3.147142	4.370722	-3.679933	3.256918	2.339589	-3.536268	-2.822216	-1.27499	-0.371425	-0.130895	2.297058
K	-1.042151	3.851736	0.914911	-0.10159	-2.58782	2.067264	1.146937	-1.61598	0.636131	-3.749449	-3.679933	4.449706	-2.21476	-4.949514	-1.664805	-0.252591	-0.283969	-4.308111	-3.390695	-3.18296
M	-0.778363	-2.129032	-2.735345	-4.311446	-0.280151	-1.422936	-3.302922	-3.80537	-1.883974	2.687196	3.256918	-2.21476	4.01351	1.499391	-3.306991	-1.661089	-0.28445	-0.735852	-0.527818	2.021563
F	-2.588363	-4.164435	-3.791105	-6.13708	0.092555	-3.625773	-5.845381	-5.322344	0.287712	1.087165	2.339589	-4.949514	1.499391	6.88993	-4.814014	-3.025869	-2.488757	3.697804	5.719887	0.296579
P	0.245538	-1.883705	-1.803378	-1.583122	-2.39208	-1.104413	-1.404187	-2.066176	-1.691202	-3.683552	-3.536268	-1.664805	-3.306991	-4.814014	9.243568	0.315891	-0.657757	-5.369852	-4.639752	-2.623008
S	1.60427	-0.474631	1.320244	0.355307	1.158078	-0.065583	-0.236009	1.120334	-0.235302	-2.251634	-2.822216	-0.252591	-1.661089	-3.025869	0.315891	2.464633	1.886155	-3.551871	-2.404231	-1.254919
T	1.106765	-0.662937	0.64561	-0.639379	0.598264	-0.273584	-0.740278	-0.806598	-0.749458	-0.256825	-1.27499	-0.283969	-0.28445	-2.488757	-0.657757	1.886155	3.029576	-3.745321	-2.612294	0.296748
W	-3.634423	-2.17102	-4.328725	-6.211701	-0.814936	-3.450669	-5.616646	-3.846239	-0.25656	-2.108091	-0.371425	-4.308111	-0.735852	3.697804	-5.369852	-3.551871	-3.745321	14.504148	4.551301	-2.556246
Y	-2.909853	-2.406849	-1.615841	-3.842757	0.126374	-2.147454	-4.190394	-4.698285	3.269526	-1.304776	-0.130895	-3.390695	-0.527818	5.719887	-4.639752	-2.404231	-2.612294	4.551301	8.369035	-1.79828
V	0.248672	-3.240142	-3.109236	-4.479712	0.70754	-2.600745	-3.540558	-3.37271	-3.034078	3.680936	2.297058	-3.18296	2.021563	0.296579	-2.623008	-1.254919	0.296748	-2.556246	-1.79828	3.675176
#ID=Gonnet
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	2.4	-0.6	-0.3	-0.3	0.5	-0.2	0	0.5	-0.8	-0.8	-1.2	-0.4	-0.7	-2.3	0.3	1.1	0.6	-3.6	-2.2	0.1
R	-0.6	4.7	0.3	-0.3	-2.2	1.5	0.4	-1	0.6	-2.4	-2.2	2.7	-1.7	-3.2	-0.9	-0.2	-0.2	-1.6	-1.8	-2
N	-0.3	0.3	3.8	2.2	-1.8	0.7	0.9	0.4	1.2	-2.8	-3	0.8	-2.2	-3.1	-0.9	0.9	0.5	-3.6	-1.4	-2.2
D	-0.3	-0.3	2.2	4.7	-3.2	0.9	2.7	0.1	0.4	-3.8	-4	0.5	-3	-4.5	-0.7	0.5	0	-5.2	-2.8	-2.9
C	0.5	-2.2	-1.8	-3.2	11.5	-2.4	-3	-2	-1.3	-1.1	-1.5	-2.8	-0.9	-0.8	-3.1	0.1	-0.5	-1	-0.5	0
Q	-0.2	1.5	0.7	0.9	-2.4	2.7	1.7	-1	1.2	-1.9	-1.6	1.5	-1	-2.6	-0.2	0.2	0	-2.7	-1.7	-1.5
E	0	0.4	0.9	2.7	-3	1.7	3.6	-0.8	0.4	-2.7	-2.8	1.2	-2	-3.9	-0.5	0.2	-0.1	-4.3	-2.7	-1.9
G	0.5	-1	0.4	0.1	-2	-1	-0.8	6.6	-1.4	-4.5	-4.4	-1.1	-3.5	-5.2	-1.6	0.4	-1.1	-4	-4	-3.3
H	-0.8	0.6	1.2	0.4	-1.3	1.2	0.4	-1.4	6	-2.2	-1.9	0.6	-1.3	-0.1	-1.1	-0.2	-0.3	-0.8	2.2	-2
I	-0.8	-2.4	-2.8	-3.8	-1.1	-1.9	-2.7	-4.5	-2.2	4	2.8	-2.1	2.5	1	-2.6	-1.8	-0.6	-1.8	-0.7	3.1
L	-1.2	-2.2	-3	-4	-1.5	-1.6	-2.8	-4.4	-1.9	2.8	4	-2.1	2.8	2	-2.3	-2.1	-1.3	-0.7	0	1.8
K	-0.4	2.7	0.8	0.5	-2.8	1.5	1.2	-1.1	0.6	-2.1	-2.1	3.2	-1.4	-3.3	-0.6	0.1	0.1	-3.5	-2.1	-1.7
M	-0.7	-1.7	-2.2	-3	-0.9	-1	-2	-3.5	-1.3	2.5	2.8	-1.4	4.3	1.6	-2.4	-1.4	-0.6	-1	-0.2	1.6
F	-2.3	-3.2	-3.1	-4.5	-0.8	-2.6	-3.9	-5.2	-0.1	1	2	-3.3	1.6	7	-3.8	-2.8	-2.2	3.6	5.1	0.1
P	0.3	-0.9	-0.9	-0.7	-3.1	-0.2	-0.5	-1.6	-1.1	-2.6	-2.3	-0.6	-2.4	-3.8	7.6	0.4	0.1	-5	-3.1	-1.8
S	1.1	-0.2	0.9	0.5	0.1	0.2	0.2	0.4	-0.2	-1.8	-2.1	0.1	-1.4	-2.8	0.4	2.2	1.5	-3.3	-1.9	-1
T	0.6	-0.2	0.5	0	-0.5	0	-0.1	-1.1	-0.3	-0.6	-1.3	0.1	-0.6	-2.2	0.1	1.5	2.5	-3.5	-1.9	0
W	-3.6	-1.6	-3.6	-5.2	-1	-2.7	-4.3	-4	-0.8	-1.8	-0.7	-3.5	-1	3.6	-5	-3.3	-3.5	14.2	4.1	-2.6
Y	-2.2	-1.8	-1.4	-2.8	-0.5	-1.7	-2.7	-4	2.2	-0.7	0	-2.1	-0.2	5.1	-3.1	-1.9	-1.9	4.1	7.8	-1.1
V	0.1	-2	-2.2	-2.9	0	-1.5	-1.9	-3.3	-2	3.1	1.8	-1.7	1.6	0.1	-1.8	-1	0	-2.6	-1.1	3.4
#ID=JTT250
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	2.247162	-1.115371	0.018661	-0.474319	-0.862808	-1.128175	-0.562737	0.62735	-1.565378	0.028817	-1.389151	-1.289328	-0.568074	-2.749373	0.894674	1.193987	1.516009	-4.073894	-3.094338	0.600747
R	-1.115371	4.559363	-0.026623	-1.142111	-0.68701	2.043184	-0.307287	0.029294	1.510162	-2.848949	-2.586138	3.62817	-2.148506	-3.976432	-0.76947	-0.593393	-0.871768	0.066963	-2.134309	-2.737266
N	0.018661	-0.026623	3.315183	2.182255	-1.284592	0.115172	0.934292	0.009391	1.174037	-1.970949	-2.911009	0.852509	-2.066347	-3.098598	-0.864101	1.118821	0.588143	-4.504224	-1.029755	-1.877747
D	-0.474319	-1.142111	2.182255	4.858454	-3.119402	0.518941	3.961325	0.681909	-0.079267	-3.138547	-4.213771	-0.086443	-3.222273	-4.855768	-2.21201	-0.353068	-0.869743	-5.144158	-2.410793	-2.459195
C	-0.862808	-0.68701	-1.284592	-3.119402	11.133109	-2.809778	-3.73354	-0.989898	-0.388327	-2.246592	-2.651015	-2.703653	-2.12445	-0.01161	-2.074778	0.617109	-0.89579	1.049375	2.379621	-1.584028
Q	-1.128175	2.043184	0.115172	0.518941	-2.809778	4.689729	1.777425	-1.32323	2.48264	-2.894193	-1.866945	2.230099	-2.089162	-3.619989	0.227298	-0.892704	-1.115477	-3.290647	-1.556294	-2.657323
E	-0.562737	-0.307287	0.934292	3.961325	-3.73354	1.777425	4.766013	0.457834	-0.426739	-3.175105	-3.975226	0.894879	-3.130426	-5.44712	-2.030864	-0.960707	-1.24211	-4.720838	-3.720613	-2.387022
G	0.62735	0.029294	0.009391	0.681909	-0.989898	-1.32323	0.457834	5.382295	-1.80656	-2.825229	-3.901648	-1.004129	-3.09826	-4.811994	-1.426383	0.575373	-0.535227	-1.546434	-4.172099	-1.798345
H	-1.565378	1.510162	1.174037	-0.079267	-0.388327	2.48264	-0.426739	-1.80656	5.884435	-2.759988	-1.795892	0.679729	-2.282213	-0.105728	-0.266178	-0.526431	-1.147172	-2.786252	3.720292	-2.813347
I	0.028817	-2.848949	-1.970949	-3.138547	-2.246592	-2.894193	-3.175105	-2.825229	-2.759988	4.151801	2.053944	-3.023107	2.945372	0.044911	-1.715159	-0.969454	0.574652	-3.590538	-2.277265	3.529934
L	-1.389151	-2.586138	-2.911009	-4.213771	-2.651015	-1.866945	-3.975226	-3.901648	-1.795892	2.053944	4.682082	-3.255396	2.800699	2.402181	-0.383216	-1.507174	-1.110691	-1.582377	-0.903096	1.575235
K	-1.289328	3.62817	0.852509	-0.086443	-2.703653	2.230099	0.894879	-1.004129	0.679729	-3.023107	-3.255396	4.974925	-2.139636	-5.048058	-1.502002	-0.775931	-0.716145	-2.962754	-3.316344	-2.977565
M	-0.568074	-2.148506	-2.066347	-3.222273	-2.12445	-2.089162	-3.130426	-3.09826	-2.282213	2.945372	2.800699	-2.139636	5.738055	0.049354	-1.552295	-1.211099	0.269882	-3.116711	-2.426286	2.404903
F	-2.749373	-3.976432	-3.098598	-4.855768	-0.01161	-3.619989	-5.44712	-4.811994	-0.105728	0.044911	2.402181	-5.048058	0.049354	7.970123	-2.500503	-1.519692	-2.436096	-0.822042	5.271608	-0.434486
P	0.894674	-0.76947	-0.864101	-2.21201	-2.074778	0.227298	-2.030864	-1.426383	-0.266178	-1.715159	-0.383216	-1.502002	-1.552295	-2.500503	6.015554	1.167865	0.527659	-4.496394	-2.921931	-1.389419
S	1.193987	-0.593393	1.118821	-0.353068	0.617109	-0.892704	-0.960707	0.575373	-0.526431	-0.969454	-1.507174	-0.775931	-1.211099	-1.519692	1.167865	1.87271	1.348966	-3.048126	-1.448038	-0.718935
T	1.516009	-0.871768	0.588143	-0.869743	-0.89579	-1.115477	-1.24211	-0.535227	-1.147172	0.574652	-1.110691	-0.716145	0.269882	-2.436096	0.527659	1.348966	2.483401	-4.212174	-2.6432	0.490428
W	-4.073894	0.066963	-4.504224	-5.144158	1.049375	-3.290647	-4.720838	-1.546434	-2.786252	-3.590538	-1.582377	-2.962754	-3.116711	-0.822042	-4.496394	-3.048126	-4.212174	15.06325	-0.164895	-3.364682
Y	-3.094338	-2.134309	-1.029755	-2.410793	2.379621	-1.556294	-3.720613	-4.172099	3.720292	-2.277265	-0.903096	-3.316344	-2.426286	5.271608	-2.921931	-1.448038	-2.6432	-0.164895	8.996493	-2.66029
V	0.600747	-2.737266	-1.877747	-2.459195	-1.584028	-2.657323	-2.387022	-1.798345	-2.813347	3.529934	1.575235	-2.977565	2.404903	-0.434486	-1.389419	-0.718935	0.490428	-3.364682	-2.66029	3.639166
#ID=VT160
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	3	-1	-1	-1	0	-1	-1	0	-2	-1	-2	-1	-1	-2	0	1	1	-3	-3	0
R	-1	6	0	-1	-2	1	-1	-1	1	-3	-2	3	-2	-3	-1	-1	-1	-1	-2	-2
N	-1	0	5	2	-2	0	0	0	1	-3	-3	1	-2	-3	-2	1	0	-4	-2	-2
D	-1	-1	2	5	-3	0	2	0	0	-4	-4	0	-3	-4	-1	0	-1	-4	-3	-3
C	0	-2	-2	-3	10	-2	-3	-2	-1	-1	-1	-3	-1	-1	-3	0	-1	-1	0	-1
Q	-1	1	0	0	-2	5	1	-2	2	-3	-2	1	-1	-3	0	0	-1	-2	-2	-2
E	-1	-1	0	2	-3	1	5	-1	-1	-3	-3	1	-2	-4	-1	-1	-1	-4	-3	-2
G	0	-1	0	0	-2	-2	-1	6	-2	-4	-4	-2	-3	-4	-2	0	-1	-2	-4	-3
H	-2	1	1	0	-1	2	-1	-2	7	-3	-2	0	-2	-1	-1	-1	-1	-2	2	-3
I	-1	-3	-3	-4	-1	-3	-3	-4	-3	4	2	-3	2	0	-3	-2	0	-2	-2	3
L	-2	-2	-3	-4	-1	-2	-3	-4	-2	2	4	-3	2	1	-2	-2	-1	-1	-1	1
K	-1	3	1	0	-3	1	1	-2	0	-3	-3	5	-2	-3	-1	-1	0	-3	-2	-2
M	-1	-2	-2	-3	-1	-1	-2	-3	-2	2	2	-2	6	0	-3	-2	0	-1	-1	1
F	-2	-3	-3	-4	-1	-3	-4	-4	-1	0	1	-3	0	7	-3	-2	-2	1	4	0
P	0	-1	-2	-1	-3	0	-1	-2	-1	-3	-2	-1	-3	-3	7	0	0	-4	-3	-2
S	1	-1	1	0	0	0	-1	0	-1	-2	-2	-1	-2	-2	0	3	1	-3	-2	-1
T	1	-1	0	-1	-1	-1	-1	-1	-1	0	-1	0	0	-2	0	1	4	-3	-2	0
W	-3	-1	-4	-4	-1	-2	-4	-2	-2	-2	-1	-3	-1	1	-4	-3	-3	12	2	-3
Y	-3	-2	-2	-3	0	-2	-3	-4	2	-2	-1	-2	-1	4	-3	-2	-2	2	8	-2
V	0	-2	-2	-3	-1	-2	-2	-3	-3	3	1	-2	1	0	-2	-1	0	-3	-2	4
#ID=BLOSUM62
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	4	-1	-2	-2	0	-1	-1	0	-2	-1	-1	-1	-1	-2	-1	1	0	-3	-2	0
R	-1	5	0	-2	-3	1	0	-2	0	-3	-2	2	-1	-3	-2	-1	-1	-3	-2	-3
N	-2	0	6	1	-3	0	0	0	1	-3	-3	0	-2	-3	-2	1	0	-4	-2	-3
D	-2	-2	1	6	-3	0	2	-1	-1	-3	-4	-1	-3	-3	-1	0	-1	-4	-3	-3
C	0	-3	-3	-3	9	-3	-4	-3	-3	-1	-1	-3	-1	-2	-3	-1	-1	-2	-2	-1
Q	-1	1	0	0	-3	5	2	-2	0	-3	-2	1	0	-3	-1	0	-1	-2	-1	-2
E	-1	0	0	2	-4	2	5	-2	0	-3	-3	1	-2	-3	-1	0	-1	-3	-2	-2
G	0	-2	0	-1	-3	-2	-2	6	-2	-4	-4	-2	-3	-3	-2	0	-2	-2	-3	-3
H	-2	0	1	-1	-3	0	0	-2	8	-3	-3	-1	-2	-1	-2	-1	-2	-2	2	-3
I	-1	-3	-3	-3	-1	-3	-3	-4	-3	4	2	-3	1	0	-3	-2	-1	-3	-1	3
L	-1	-2	-3	-4	-1	-2	-3	-4	-3	2	4	-2	2	0	-3	-2	-1	-2	-1	1
K	-1	2	0	-1	-3	1	1	-2	-1	-3	-2	5	-1	-3	-1	0	-1	-3	-2	-2
M	-1	-1	-2	-3	-1	0	-2	-3	-2	1	2	-1	5	0	-2	-1	-1	-1	-1	1
F	-2	-3	-3	-3	-2	-3	-3	-3	-1	0	0	-3	0	6	-4	-2	-2	1	3	-1
P	-1	-2	-2	-1	-3	-1	-1	-2	-2	-3	-3	-1	-2	-4	7	-1	-1	-4	-3	-2
S	1	-1	1	0	-1	0	0	0	-1	-2	-2	0	-1	-2	-1	4	1	-3	-2	-2
T	0	-1	0	-1	-1	-1	-1	-2	-2	-1	-1	-1	-1	-2	-1	1	5	-2	-2	0
W	-3	-3	-4	-4	-2	-2	-3	-2	-2	-3	-2	-3	-1	1	-4	-3	-2	11	2	-3
Y	-2	-2	-2	-3	-2	-1	-2	-3	2	-1	-1	-2	-1	3	-3	-2	-2	2	7	-1
V	0	-3	-3	-3	-1	-2	-2	-3	-3	3	1	-2	1	-1	-2	-2	0	-3	-1	4
#ID=PAM250
	A	R	N	D	C	Q	E	G	H	I	L	K	M	F	P	S	T	W	Y	V
A	1.799581	-1.529141	0.169213	0.293517	-2.016132	-0.435831	0.312581	1.261832	-1.340236	-0.509936	-1.881234	-1.144546	-1.124868	-3.479902	1.11258	1.097275	1.187865	-5.751471	-3.44853	0.188697
R	-1.529141	6.081227	0.001649	-1.273321	-3.638634	1.248577	-1.052738	-2.531084	1.546238	-1.999686	-2.978344	3.371645	-0.434683	-4.421103	-0.173796	-0.319727	-0.852118	2.174432	-4.186348	-2.486428
N	0.169213	0.001649	2.003793	2.057925	-3.612772	0.776298	1.430201	0.360504	1.573307	-1.791384	-2.855094	0.991217	-1.722962	-3.474242	-0.48366	0.689267	0.437309	-4.01835	-2.063292	-1.736687
D	0.293517	-1.273321	2.057925	3.845806	-5.09069	1.638167	3.400184	0.596277	0.69204	-2.348035	-3.96517	0.088163	-2.58883	-5.578761	-0.925724	0.288691	-0.140548	-6.671914	-4.302316	-2.117114
C	-2.016132	-3.638634	-3.612772	-5.09069	11.920927	-5.340605	-5.259483	-3.35382	-3.42879	-2.294994	-6.010978	-5.392561	-5.197621	-4.269379	-2.758507	-0.044271	-2.193434	-7.675773	0.332078	-1.933456
Q	-0.435831	1.248577	0.776298	1.638167	-5.340605	4.035014	2.469161	-1.192139	2.909569	-2.022672	-1.758741	0.731412	-0.986381	-4.609222	0.234328	-0.499887	-0.784586	-4.713362	-4.010773	-1.859015
E	0.312581	-1.052738	1.430201	3.400184	-5.259483	2.469161	3.811813	0.189398	0.66211	-2.016888	-3.313037	-0.049209	-2.104257	-5.376486	-0.548346	-0.003836	-0.385644	-6.920686	-4.267757	-1.787361
G	1.261832	-2.531084	0.360504	0.596277	-3.35382	-1.192139	0.189398	4.737181	-2.08541	-2.518176	-4.003639	-1.666816	-2.77191	-4.753307	-0.47742	1.061268	-0.002402	-6.93341	-5.194985	-1.328752
H	-1.340236	1.546238	1.573307	0.69204	-3.42879	2.909569	0.66211	-2.08541	6.48271	-2.415645	-2.061853	-0.037557	-2.130852	-1.795661	-0.235754	-0.80032	-1.290273	-2.623766	-0.094686	-2.224075
I	-0.509936	-1.999686	-1.791384	-2.348035	-2.294994	-2.022672	-2.016888	-2.518176	-2.415645	4.5024	2.42017	-1.918976	2.164142	1.009283	-2.007643	-1.401374	0.069729	-5.150155	-0.956712	3.669062
L	-1.881234	-2.978344	-2.855094	-3.96517	-6.010978	-1.758741	-3.313037	-4.003639	-2.061853	2.42017	5.923768	-2.828542	3.672334	1.810514	-2.530274	-2.783677	-1.680305	-1.877753	-0.87084	1.846403
K	-1.144546	3.371645	0.991217	0.088163	-5.392561	0.731412	-0.049209	-1.666816	-0.037557	-1.918976	-2.828542	4.643366	0.406283	-5.214443	-1.118761	-0.167511	-0.01815	-3.437219	-4.409888	-2.419049
M	-1.124868	-0.434683	-1.722962	-2.58883	-5.197621	-0.986381	-2.104257	-2.77191	-2.130852	2.164142	3.672334	0.406283	6.42093	0.186192	-2.051183	-1.546628	-0.585836	-4.226628	-2.431651	1.782299
F	-3.479902	-4.421103	-3.474242	-5.578761	-4.269379	-4.609222	-5.376486	-4.753307	-1.795661	1.009283	1.810514	-5.214443	0.186192	9.024465	-4.516841	-3.183604	-3.090067	0.330865	6.956359	-1.141885
P	1.11258	-0.173796	-0.48366	-0.925724	-2.758507	0.234328	-0.548346	-0.47742	-0.235754	-2.007643	-2.530274	-1.118761	-2.051183	-4.516841	5.820477	0.940636	0.315308	-5.562344	-4.897783	-1.191684
S	1.097275	-0.319727	0.689267	0.288691	-0.044271	-0.499887	-0.003836	1.061268	-0.80032	-1.401374	-2.783677	-0.167511	-1.546628	-3.183604	0.940636	1.580687	1.332336	-2.465583	-2.824967	-0.967218
T	1.187865	-0.852118	0.437309	-0.140548	-2.193434	-0.784586	-0.385644	-0.002402	-1.290273	0.069729	-1.680305	-0.01815	-0.585836	-3.090067	0.315308	1.332336	2.557308	-5.110824	-2.73953	0.2812
W	-5.751471	2.174432	-4.01835	-6.671914	-7.675773	-4.713362	-6.920686	-6.93341	-2.623766	-5.150155	-1.877753	-3.437219	-4.226628	0.330865	-5.562344	-2.465583	-5.110824	17.197425	-0.121114	-6.206678
Y	-3.44853	-4.186348	-2.063292	-4.302316	0.332078	-4.010773	-4.267757	-5.194985	-0.094686	-0.956712	-0.87084	-4.409888	-2.431651	6.956359	-4.897783	-2.824967	-2.73953	-0.121114	10.121883	-2.450603
V	0.188697	-2.486428	-1.736687	-2.117114	-1.933456	-1.859015	-1.787361	-1.328752	-2.224075	3.669062	1.846403	-2.419049	1.782299	-1.141885	-1.191684	-0.967218	0.2812	-6.206678	-2.450603	4.292353"""
_matrix_text_lines=_matrix_text.split("\n")
subst_matrices = {}
import sys
class smatrix(object):
  def __init__(self,t):
    self.data = []
    self.row = {}
    self.col = {}
    head = t[0].split("\t")
    for i,h in enumerate(head[1:]):
      self.col[h] = i
    for i,line in enumerate(t[1:]):
      words = line.split("\t")
      self.row[words[0]] = i
      self.data.append([float(x) for x in words[1:]])
  def get(self,r,c):
    return self.data[self.row[r]][self.col[c]]
  def output(self):
    for i in self.data:
      print "\t".join([str(x) for x in i])

for _l in _matrix_text_lines:
  if _l.startswith("#ID="):
    _id = _l.split("=")[1]
    _lb = []
    continue
  if _l == "":
    continue
  _lb.append(_l)
  if len(_lb) == 21:
    subst_matrices[_id] = smatrix(_lb)


